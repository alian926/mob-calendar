{"ast":null,"code":"import _asyncToGenerator from\"/Users/alian/Desktop/git-source/react-mob-calendar/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectSpread from\"/Users/alian/Desktop/git-source/react-mob-calendar/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/alian/Desktop/git-source/react-mob-calendar/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/alian/Desktop/git-source/react-mob-calendar/node_modules/@babel/runtime/regenerator/index.js\";/* eslint-disable react/destructuring-assignment */ /**\n * 日视图/列表视图 日历\n */import React,{useEffect,useRef,useMemo}from'react';import dayjs from'dayjs';import cn from'classnames';import{animated,useSpring,useSprings,easings}from'@react-spring/web';import{useDrag}from'@use-gesture/react';import{formatMonthDate,formatWeekDate,formatMonthYear,mergeProps}from'../../utils/index';import{useSetState}from'../../utils/hooks';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var defaultFunc=function defaultFunc(){// console.log('default function:', rest);\n};var defaultCalendarProps={currentDate:new Date(),showType:'week',transitionDuration:300,onDateClick:defaultFunc,onTouchStart:defaultFunc,onTouchMove:defaultFunc,onTouchEnd:defaultFunc,onToggleShowType:defaultFunc,markDates:[],easing:easings.easeInOutCirc,cellHeight:38,cellMarginBottom:4,bottomSpace:12};var head=['日','一','二','三','四','五','六'];var Calendar=function Calendar(p){var props=mergeProps(defaultCalendarProps,p);var _useSetState=useSetState({currentMonthFirstDay:dayjs().startOf('month'),monthDates:[],// 月日历需要展示的日期 包括前一月 当月 下一月\ncurrentWeekFirstDay:dayjs().startOf('week'),weekDates:[],// 周日历需要展示的日期  包括前一周 当周 下一周\ncurrentDate:dayjs(),touch:{x:0,y:0},translateIndex:0,calendarY:0,// 于Y轴的位置\nshowType:props.showType,isTouching:false}),_useSetState2=_slicedToArray(_useSetState,2),state=_useSetState2[0],setState=_useSetState2[1];// 是否拖动中\nvar isTouchingRef=useRef(false);// 日历dom\nvar calendarRef=useRef(null);// 收起为周视图, 展开为月视图\nvar isMonthView=state.showType==='month';// 周视图高度\nvar shortLength=props.cellHeight+props.cellMarginBottom+props.bottomSpace;// 月视图高度\nvar longLength=(props.cellHeight+props.cellMarginBottom)*6+props.bottomSpace;// 更新日期. 模拟 getDerivedStateFromProps\nuseEffect(function(){var dayjsDate=dayjs(props.currentDate);setState(_objectSpread(_objectSpread(_objectSpread({},formatMonthDate(dayjsDate)),formatWeekDate(dayjsDate)),{},{currentDate:dayjsDate}));},[props.currentDate,setState]);// 点击选中日期\nvar handleDayClick=function handleDayClick(dayjsDate){if(dayjs(state.currentDate).isSame(dayjsDate,'day')){return;}setState(_objectSpread(_objectSpread(_objectSpread({},formatMonthDate(dayjsDate)),formatWeekDate(dayjsDate)),{},{currentDate:dayjsDate}));props.onDateClick(dayjsDate.toDate());};// 父容器常规显示指定选中内容y轴高度\nvar pos=useMemo(function(){var _state$monthDates$;var index=(_state$monthDates$=state.monthDates[1])===null||_state$monthDates$===void 0?void 0:_state$monthDates$.findIndex(function(item){return item.isSame(state.currentDate,'day');});var pos=Math.floor(index/7)||0;return-pos*(props.cellHeight+props.cellMarginBottom);},[state.currentDate,state.monthDates,props.cellHeight,props.cellMarginBottom]);// 父容器位移变化\nvar _useSpring=useSpring(function(){return{from:{transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, 0, 0)\")},config:{clamp:true,duration:props.transitionDuration,easing:props.easing}};}),_useSpring2=_slicedToArray(_useSpring,2),containerStyle=_useSpring2[0],containerApi=_useSpring2[1];// 最外层容器高度\nvar _useSpring3=useSpring(function(){return{from:{height:shortLength},config:{clamp:true,duration:props.transitionDuration,easing:props.easing}};}),_useSpring4=_slicedToArray(_useSpring3,2),heightStyle=_useSpring4[0],heightApi=_useSpring4[1];// 子容器横向位移\nvar _useSprings=useSprings(3,function(i){return{from:{transform:\"translate3d(\".concat((i-1+state.translateIndex)*100,\"%, \").concat(state.calendarY,\"px, 0)\")},config:{clamp:true,duration:props.transitionDuration,easing:props.easing}};}),_useSprings2=_slicedToArray(_useSprings,2),springStyles=_useSprings2[0],springApi=_useSprings2[1];// 父容器位移数字初始化\nuseEffect(function(){containerApi.start({to:function(){var _to=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(next){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return next({transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, \").concat(isMonthView?0:pos,\"px, 0)\"),immediate:true});case 2:case\"end\":return _context.stop();}}},_callee);}));function to(_x){return _to.apply(this,arguments);}return to;}()});},[state.translateIndex,containerApi,pos,isMonthView]);useEffect(function(){if(!state.isTouching)return;containerApi.start({to:function(){var _to2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(next){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return next({transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, 0px, 0)\"),immediate:true});case 2:case\"end\":return _context2.stop();}}},_callee2);}));function to(_x2){return _to2.apply(this,arguments);}return to;}()});},[state.isTouching,containerApi,state.translateIndex]);// 横向移动计算\nvar runHorizontal=function runHorizontal(dragState){var _calendarRef$current;var _dragState$movement=_slicedToArray(dragState.movement,1),x=_dragState$movement[0];if(dragState.last){isTouchingRef.current=false;if(Math.abs(x)>80){var add=x>0?1:-1;springApi.start(function(i){return{to:function(){var _to3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(next){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return next({transform:\"translate3d(\".concat((i-1+state.translateIndex+add)*100,\"%, \").concat(state.calendarY,\"px, 0)\")});case 2:case\"end\":return _context3.stop();}}},_callee3);}));function to(_x3){return _to3.apply(this,arguments);}return to;}()};});setState({translateIndex:state.translateIndex+add,isTouching:false});if(isMonthView){var nextMonthFirstDay=state.currentMonthFirstDay[add>0?'subtract':'add'](1,'month');handleDayClick(nextMonthFirstDay);}else{var nextWeekFirstDay=state.currentWeekFirstDay[add>0?'subtract':'add'](1,'week');handleDayClick(nextWeekFirstDay);}}else{springApi.start(function(i){return{to:function(){var _to4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(next){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return next({transform:\"translate3d(\".concat((i-1+state.translateIndex)*100,\"%, \").concat(state.calendarY,\"px, 0)\")});case 2:case\"end\":return _context4.stop();}}},_callee4);}));function to(_x4){return _to4.apply(this,arguments);}return to;}()};});}return;}var width=((_calendarRef$current=calendarRef.current)===null||_calendarRef$current===void 0?void 0:_calendarRef$current.offsetWidth)||1;var xPersent=x/width;springApi.start(function(i){return{transform:\"translate3d(\".concat((i-1+state.translateIndex+xPersent)*100,\"%, \").concat(state.calendarY,\"px, 0)\"),immediate:true};});};// 纵向移动计算\nvar runVertical=function runVertical(dragState){var _dragState$movement2=_slicedToArray(dragState.movement,2),y=_dragState$movement2[1];var height=isMonthView?longLength:shortLength;if(dragState.last){if(Math.abs(y)>50){if(y>0){handleShowTypeToggle('month');}else{handleShowTypeToggle('week');}}else{heightApi.start({to:function(){var _to5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(next){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return next({height:height,immediate:false});case 2:case\"end\":return _context5.stop();}}},_callee5);}));function to(_x5){return _to5.apply(this,arguments);}return to;}()});containerApi.start({to:function(){var _to6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(next){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_context6.next=2;return next({transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, \").concat(isMonthView?0:pos,\"px, 0)\"),immediate:false});case 2:case\"end\":return _context6.stop();}}},_callee6);}));function to(_x6){return _to6.apply(this,arguments);}return to;}()});}return;}if(height+y>longLength||height+y<shortLength){return;}var targetHeight=Math.max(height+y,shortLength);var targetY=Math.min(pos+y*0.7,0);if(isMonthView){targetHeight=Math.min(height+y,longLength);targetY=Math.max(pos,y*0.7);}heightApi.start({to:function(){var _to7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(next){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_context7.next=2;return next({height:targetHeight,immediate:true});case 2:case\"end\":return _context7.stop();}}},_callee7);}));function to(_x7){return _to7.apply(this,arguments);}return to;}()});containerApi.start({to:function(){var _to8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(next){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return next({transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, \").concat(targetY,\"px, 0)\"),immediate:true});case 2:case\"end\":return _context8.stop();}}},_callee8);}));function to(_x8){return _to8.apply(this,arguments);}return to;}()});};// 拖动, 周末式切换的时候, 需要用星期来展示列表\nuseDrag(function(dragState){dragState.event.stopPropagation();if(dragState.first){isTouchingRef.current=true;}if(dragState.axis==='x'){if(!isMonthView&&!state.isTouching){setState({isTouching:true});}runHorizontal(dragState);}if(dragState.axis==='y'){runVertical(dragState);}},{pointer:{touch:true},target:calendarRef,eventOptions:{passive:false}});// 切换模式\nvar handleShowTypeToggle=function handleShowTypeToggle(type){var targetType=type?type:isMonthView?'week':'month';containerApi.start({to:function(){var _to9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(next){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return next({transform:\"translate3d(\".concat(-state.translateIndex*100,\"%, \").concat(targetType==='week'?pos:0,\"px, 0)\"),immediate:false});case 2:setState({showType:targetType});case 3:case\"end\":return _context9.stop();}}},_callee9);}));function to(_x9){return _to9.apply(this,arguments);}return to;}()});heightApi.start({to:function(){var _to10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(next){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return next({height:targetType==='week'?shortLength:longLength,immediate:false});case 2:case\"end\":return _context10.stop();}}},_callee10);}));function to(_x10){return _to10.apply(this,arguments);}return to;}()});};// 格式化日期显示\nvar formatDay=function formatDay(date){if(dayjs().isSame(date,'day')){return/*#__PURE__*/_jsx(\"span\",{style:{color:'#3388FF'},children:\"\\u4ECA\"});}// 'YYYY-MM-DD HH:mm:ss'\nreturn dayjs(date).format('D');};var dayCellRender=function dayCellRender(date,index){var showGray=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;// 选中日期\nvar isCurrentDay=date.isSame(state.currentDate,'day');// 其它月的日期, 在星期的模式下不显示置灰\nvar isOtherMonthDay=showGray&&!date.isSame(state.currentMonthFirstDay,'month');// 是否为标志过的日期\nvar isMarkDate=props.markDates.find(function(d){return date.isSame(d,'day');});return/*#__PURE__*/_jsxs(\"div\",{className:cn('day-cell',{'is-other-month-day':isOtherMonthDay,'current-day':isCurrentDay}),style:{height:\"\".concat(props.cellHeight,\"px\"),marginBottom:\"\".concat(props.cellMarginBottom,\"px\")},onClick:function onClick(){return handleDayClick(date);},children:[/*#__PURE__*/_jsx(\"div\",{className:\"day-text\",children:formatDay(date)}),isMarkDate&&/*#__PURE__*/_jsx(\"div\",{className:\"dot-mark\"})]},index);};return/*#__PURE__*/_jsxs(\"div\",{className:\"react-mob-calendar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"calendar-operate\",children:/*#__PURE__*/_jsx(\"div\",{children:formatMonthYear(state.currentDate)})}),/*#__PURE__*/_jsx(\"div\",{className:\"calendar-head\",children:head.map(function(i){return/*#__PURE__*/_jsx(\"div\",{className:\"head-cell\",children:i},i);})}),/*#__PURE__*/_jsxs(animated.div,{className:cn('calendar-body',{'week-mode':isMonthView}),style:heightStyle,ref:calendarRef,children:[/*#__PURE__*/_jsxs(animated.div,{style:containerStyle,children:[springStyles.map(function(style,i){var _state$monthDates$i;return/*#__PURE__*/_jsx(animated.div,{className:cn('month-cell',{'is-hidden':!isMonthView&&state.isTouching}),style:style,children:(_state$monthDates$i=state.monthDates[i])===null||_state$monthDates$i===void 0?void 0:_state$monthDates$i.map(function(day,index){return dayCellRender(day,index,i===1);})},i);}),springStyles.map(function(style,i){var _state$weekDates$i;return/*#__PURE__*/_jsx(animated.div,{className:cn('month-cell',{'is-hidden':!(!isMonthView&&state.isTouching)}),style:style,children:(_state$weekDates$i=state.weekDates[i])===null||_state$weekDates$i===void 0?void 0:_state$weekDates$i.map(function(day,index){return dayCellRender(day,index);})},i);})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-operate\",children:!props.disabledMonthView&&/*#__PURE__*/_jsx(\"div\",{role:\"presentation\",onClick:function onClick(){return handleShowTypeToggle();},className:\"bottom-operate-btn\"})})]})]});};export default Calendar;","map":{"version":3,"sources":["/Users/alian/Desktop/git-source/react-mob-calendar/src/components/calendar/Calendar.tsx"],"names":["React","useEffect","useRef","useMemo","dayjs","cn","animated","useSpring","useSprings","easings","useDrag","formatMonthDate","formatWeekDate","formatMonthYear","mergeProps","useSetState","defaultFunc","defaultCalendarProps","currentDate","Date","showType","transitionDuration","onDateClick","onTouchStart","onTouchMove","onTouchEnd","onToggleShowType","markDates","easing","easeInOutCirc","cellHeight","cellMarginBottom","bottomSpace","head","Calendar","p","props","currentMonthFirstDay","startOf","monthDates","currentWeekFirstDay","weekDates","touch","x","y","translateIndex","calendarY","isTouching","state","setState","isTouchingRef","calendarRef","isMonthView","shortLength","longLength","dayjsDate","handleDayClick","isSame","toDate","pos","index","findIndex","item","Math","floor","from","transform","config","clamp","duration","containerStyle","containerApi","height","heightStyle","heightApi","i","springStyles","springApi","start","to","next","immediate","runHorizontal","dragState","movement","last","current","abs","add","nextMonthFirstDay","nextWeekFirstDay","width","offsetWidth","xPersent","runVertical","handleShowTypeToggle","targetHeight","max","targetY","min","event","stopPropagation","first","axis","pointer","target","eventOptions","passive","type","targetType","formatDay","date","color","format","dayCellRender","showGray","isCurrentDay","isOtherMonthDay","isMarkDate","find","d","marginBottom","map","style","day","disabledMonthView"],"mappings":"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","sourcesContent":["/* eslint-disable react/destructuring-assignment */\n/**\n * 日视图/列表视图 日历\n */\nimport React, { FC, useEffect, useRef, useMemo } from 'react';\nimport dayjs, { Dayjs } from 'dayjs';\nimport cn from 'classnames';\nimport { animated, useSpring, useSprings, easings } from '@react-spring/web';\nimport { useDrag, FullGestureState } from '@use-gesture/react';\n\nimport {\n    formatMonthDate,\n    formatWeekDate,\n    formatMonthYear,\n    mergeProps,\n} from '../../utils/index';\n\nimport { useSetState } from '../../utils/hooks';\n\nexport type CalendarProps = {\n    // 选中日期\n    currentDate?: Date;\n    // 展示方式\n    showType?: 'week' | 'month';\n    // 动画时间\n    transitionDuration?: number;\n    // 点击选中日期\n    onDateClick?: Function;\n    // 拖动开始\n    onTouchStart?: Function;\n    // 拖动过程\n    onTouchMove?: Function;\n    // 拖动结束\n    onTouchEnd?: (start: number, end: number) => void;\n    // 更换视图模式\n    onToggleShowType?: Function;\n    // 标记日期\n    markDates?: Date[];\n    // 禁用月视图\n    disabledMonthView?: boolean;\n    // 变化趋势\n    easing?: typeof easings;\n    // 日期高度\n    cellHeight?: number;\n    // 日期底部间隔\n    cellMarginBottom?: number;\n    // 日期容器底部间距\n    bottomSpace?: number;\n};\n\nconst defaultFunc = (...rest: any) => {\n    // console.log('default function:', rest);\n};\n\nconst defaultCalendarProps = {\n    currentDate: new Date(),\n    showType: 'week',\n    transitionDuration: 300,\n    onDateClick: defaultFunc,\n    onTouchStart: defaultFunc,\n    onTouchMove: defaultFunc,\n    onTouchEnd: defaultFunc,\n    onToggleShowType: defaultFunc,\n    markDates: [],\n    easing: easings.easeInOutCirc,\n    cellHeight: 38,\n    cellMarginBottom: 4,\n    bottomSpace: 12\n};\n\ntype DragType = Omit<FullGestureState<'drag'>, 'event'> & {\n    event: PointerEvent | MouseEvent | globalThis.TouchEvent | KeyboardEvent;\n};\n\ntype StateValue = {\n    currentMonthFirstDay: Dayjs;\n    monthDates: Dayjs[][];\n    currentWeekFirstDay: Dayjs;\n    weekDates: Dayjs[][];\n    currentDate: Dayjs;\n    touch: { x: number; y: number };\n    translateIndex: number;\n    calendarY: number;\n    showType: CalendarProps['showType'];\n    isTouching: boolean;\n};\n\nconst head = ['日', '一', '二', '三', '四', '五', '六'];\n\nconst Calendar: FC<CalendarProps> = p => {\n    const props = mergeProps(defaultCalendarProps, p);\n\n    const [state, setState] = useSetState<StateValue>({\n        currentMonthFirstDay: dayjs().startOf('month'),\n        monthDates: [], // 月日历需要展示的日期 包括前一月 当月 下一月\n        currentWeekFirstDay: dayjs().startOf('week'),\n        weekDates: [], // 周日历需要展示的日期  包括前一周 当周 下一周\n        currentDate: dayjs(),\n        touch: { x: 0, y: 0 },\n        translateIndex: 0,\n        calendarY: 0, // 于Y轴的位置\n        showType: props.showType,\n        isTouching: false,\n    });\n\n    // 是否拖动中\n    const isTouchingRef = useRef(false);\n    // 日历dom\n    const calendarRef = useRef<HTMLDivElement>(null);\n\n    // 收起为周视图, 展开为月视图\n    const isMonthView = state.showType === 'month';\n\n    // 周视图高度\n    const shortLength = props.cellHeight + props.cellMarginBottom + props.bottomSpace;\n\n    // 月视图高度\n    const longLength = (props.cellHeight + props.cellMarginBottom) * 6 + props.bottomSpace;\n\n    // 更新日期. 模拟 getDerivedStateFromProps\n    useEffect(() => {\n        const dayjsDate = dayjs(props.currentDate);\n        setState({\n            ...formatMonthDate(dayjsDate),\n            ...formatWeekDate(dayjsDate),\n            currentDate: dayjsDate,\n        });\n    }, [props.currentDate, setState]);\n\n    // 点击选中日期\n    const handleDayClick = (dayjsDate: Dayjs) => {\n        if (dayjs(state.currentDate).isSame(dayjsDate, 'day')) {\n            return;\n        }\n        setState({\n            ...formatMonthDate(dayjsDate),\n            ...formatWeekDate(dayjsDate),\n            currentDate: dayjsDate,\n        });\n        props.onDateClick(dayjsDate.toDate());\n    };\n\n    // 父容器常规显示指定选中内容y轴高度\n    const pos = useMemo(() => {\n        const index = state.monthDates[1]?.findIndex(item =>\n            item.isSame(state.currentDate, 'day')\n        );\n        const pos = Math.floor(index / 7) || 0;\n        return -pos * (props.cellHeight + props.cellMarginBottom);\n    }, [state.currentDate, state.monthDates, props.cellHeight, props.cellMarginBottom]);\n\n    // 父容器位移变化\n    const [containerStyle, containerApi] = useSpring(() => ({\n        from: {\n            transform: `translate3d(${-state.translateIndex * 100}%, 0, 0)`,\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    // 最外层容器高度\n    const [heightStyle, heightApi] = useSpring(() => ({\n        from: {\n            height: shortLength,\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    // 子容器横向位移\n    const [springStyles, springApi] = useSprings(3, i => ({\n        from: {\n            transform: `translate3d(${(i - 1 + state.translateIndex) * 100}%, ${\n                state.calendarY\n            }px, 0)`,\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    // 父容器位移数字初始化\n    useEffect(() => {\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${-state.translateIndex * 100}%, ${\n                        isMonthView ? 0 : pos\n                    }px, 0)`,\n                    immediate: true,\n                });\n            },\n        });\n    }, [state.translateIndex, containerApi, pos, isMonthView]);\n\n    useEffect(() => {\n        if (!state.isTouching) return;\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${\n                        -state.translateIndex * 100\n                    }%, 0px, 0)`,\n                    immediate: true,\n                });\n            },\n        });\n    }, [state.isTouching, containerApi, state.translateIndex]);\n    // 横向移动计算\n    const runHorizontal = (dragState: DragType) => {\n        const [x] = dragState.movement;\n        if (dragState.last) {\n            isTouchingRef.current = false;\n            if (Math.abs(x) > 80) {\n                const add = x > 0 ? 1 : -1;\n                springApi.start(i => ({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                (i - 1 + state.translateIndex + add) * 100\n                            }%, ${state.calendarY}px, 0)`,\n                        });\n                    },\n                }));\n                setState({\n                    translateIndex: state.translateIndex + add,\n                    isTouching: false,\n                });\n                if (isMonthView) {\n                    const nextMonthFirstDay = state.currentMonthFirstDay[\n                        add > 0 ? 'subtract' : 'add'\n                    ](1, 'month');\n                    handleDayClick(nextMonthFirstDay);\n                } else {\n                    const nextWeekFirstDay = state.currentWeekFirstDay[\n                        add > 0 ? 'subtract' : 'add'\n                    ](1, 'week');\n                    handleDayClick(nextWeekFirstDay);\n                }\n            } else {\n                springApi.start(i => ({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                (i - 1 + state.translateIndex) * 100\n                            }%, ${state.calendarY}px, 0)`,\n                        });\n                    },\n                }));\n            }\n            return;\n        }\n        const width = calendarRef.current?.offsetWidth || 1;\n        const xPersent = x / width;\n        springApi.start(i => ({\n            transform: `translate3d(${\n                (i - 1 + state.translateIndex + xPersent) * 100\n            }%, ${state.calendarY}px, 0)`,\n            immediate: true,\n        }));\n    };\n\n    // 纵向移动计算\n    const runVertical = (dragState: DragType) => {\n        const [, y] = dragState.movement;\n        const height = isMonthView ? longLength : shortLength;\n        if (dragState.last) {\n            if (Math.abs(y) > 50) {\n                if (y > 0) {\n                    handleShowTypeToggle('month');\n                } else {\n                    handleShowTypeToggle('week');\n                }\n            } else {\n                heightApi.start({\n                    to: async next => {\n                        await next({\n                            height,\n                            immediate: false,\n                        });\n                    },\n                });\n                containerApi.start({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                -state.translateIndex * 100\n                            }%, ${isMonthView ? 0 : pos}px, 0)`,\n                            immediate: false,\n                        });\n                    },\n                });\n            }\n            return;\n        }\n        if (height + y > longLength || height + y < shortLength) {\n            return;\n        }\n        let targetHeight = Math.max(height + y, shortLength);\n        let targetY = Math.min(pos + y * 0.7, 0);\n        if (isMonthView) {\n            targetHeight = Math.min(height + y, longLength);\n            targetY = Math.max(pos, y * 0.7);\n        }\n        heightApi.start({\n            to: async next => {\n                await next({\n                    height: targetHeight,\n                    immediate: true,\n                });\n            },\n        });\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${\n                        -state.translateIndex * 100\n                    }%, ${targetY}px, 0)`,\n                    immediate: true,\n                });\n            },\n        });\n    };\n\n    // 拖动, 周末式切换的时候, 需要用星期来展示列表\n    useDrag(\n        dragState => {\n            dragState.event.stopPropagation();\n            if (dragState.first) {\n                isTouchingRef.current = true;\n            }\n\n            if (dragState.axis === 'x') {\n                if (!isMonthView && !state.isTouching) {\n                    setState({ isTouching: true });\n                }\n                runHorizontal(dragState);\n            }\n\n            if (dragState.axis === 'y') {\n                runVertical(dragState);\n            }\n        },\n        {\n            pointer: { touch: true },\n            target: calendarRef,\n            eventOptions: { passive: false },\n        }\n    );\n\n    // 切换模式\n    const handleShowTypeToggle = (type?: 'week' | 'month') => {\n        const targetType = type ? type : isMonthView ? 'week' : 'month';\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${-state.translateIndex * 100}%, ${\n                        targetType === 'week' ? pos : 0\n                    }px, 0)`,\n                    immediate: false,\n                });\n                setState({\n                    showType: targetType,\n                });\n            },\n        });\n        heightApi.start({\n            to: async next => {\n                await next({\n                    height: targetType === 'week' ? shortLength : longLength,\n                    immediate: false,\n                });\n            },\n        });\n    };\n\n    // 格式化日期显示\n    const formatDay = (date: Dayjs) => {\n        if (dayjs().isSame(date, 'day')) {\n            return <span style={{ color: '#3388FF' }}>今</span>;\n        }\n        // 'YYYY-MM-DD HH:mm:ss'\n        return dayjs(date).format('D');\n    };\n\n    const dayCellRender = (date: Dayjs, index: number, showGray = false) => {\n        // 选中日期\n        const isCurrentDay = date.isSame(state.currentDate, 'day');\n        // 其它月的日期, 在星期的模式下不显示置灰\n        const isOtherMonthDay =\n            showGray && !date.isSame(state.currentMonthFirstDay, 'month');\n        // 是否为标志过的日期\n        const isMarkDate = props.markDates.find(d => date.isSame(d, 'day'));\n        return (\n            <div\n                key={index}\n                className={cn('day-cell', {\n                    'is-other-month-day': isOtherMonthDay,\n                    'current-day': isCurrentDay,\n                })}\n                style={{\n                    height: `${props.cellHeight}px`,\n                    marginBottom: `${props.cellMarginBottom}px`\n                }}\n                onClick={() => handleDayClick(date)}>\n                <div className='day-text'>{formatDay(date)}</div>\n                {isMarkDate && <div className='dot-mark' />}\n            </div>\n        );\n    };\n\n    return (\n        <div className='react-mob-calendar'>\n            {/* 年月 */}\n            <div className='calendar-operate'>\n                <div>{formatMonthYear(state.currentDate)}</div>\n            </div>\n\n            {/* 星期 */}\n            <div className='calendar-head'>\n                {head.map(i => (\n                    <div className='head-cell' key={i}>\n                        {i}\n                    </div>\n                ))}\n            </div>\n\n            {/* 日期表格 */}\n            <animated.div\n                className={cn('calendar-body', { 'week-mode': isMonthView })}\n                style={heightStyle}\n                ref={calendarRef}>\n                <animated.div style={containerStyle}>\n                    {/* 月视图 */}\n                    {springStyles.map((style, i) => {\n                        return (\n                            <animated.div\n                                className={cn('month-cell', {\n                                    'is-hidden':\n                                        !isMonthView && state.isTouching,\n                                })}\n                                key={i}\n                                style={style}>\n                                {state.monthDates[i]?.map((day, index) =>\n                                    dayCellRender(day, index, i === 1)\n                                )}\n                            </animated.div>\n                        );\n                    })}\n                    {/* 周视图 */}\n                    {springStyles.map((style, i) => {\n                        return (\n                            <animated.div\n                                className={cn('month-cell', {\n                                    'is-hidden': !(\n                                        !isMonthView && state.isTouching\n                                    ),\n                                })}\n                                key={i}\n                                style={style}>\n                                {state.weekDates[i]?.map((day, index) =>\n                                    dayCellRender(day, index)\n                                )}\n                            </animated.div>\n                        );\n                    })}\n                </animated.div>\n                <div className='bottom-operate'>\n                    {!props.disabledMonthView && (\n                        <div\n                            role='presentation'\n                            onClick={() => handleShowTypeToggle()}\n                            className='bottom-operate-btn'\n                        />\n                    )}\n                </div>\n            </animated.div>\n        </div>\n    );\n};\n\nexport default Calendar;\n"]},"metadata":{},"sourceType":"module"}