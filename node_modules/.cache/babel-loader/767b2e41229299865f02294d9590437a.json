{"ast":null,"code":"var _jsxFileName = \"/Users/alian/Desktop/git-source/react-mob-calendar/src/components/calendar/Calendar.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\n/* eslint-disable react/destructuring-assignment */\n\n/**\n * 日视图/列表视图 日历\n */\nimport React, { useEffect, useRef, useMemo } from 'react';\nimport dayjs from 'dayjs';\nimport cn from 'classnames';\nimport { animated, useSpring, useSprings, easings } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { formatMonthDate, formatWeekDate, formatMonthYear, mergeProps } from '../../utils/index';\nimport { useSetState } from '../../utils/hooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst defaultFunc = function () {// console.log('default function:', rest);\n};\n\nconst defaultCalendarProps = {\n  currentDate: new Date(),\n  showType: 'week',\n  transitionDuration: 3000,\n  onDateClick: defaultFunc,\n  onTouchStart: defaultFunc,\n  onTouchMove: defaultFunc,\n  onTouchEnd: defaultFunc,\n  onToggleShowType: defaultFunc,\n  markDates: [],\n  easing: easings.easeInOutCirc\n};\nconst head = ['日', '一', '二', '三', '四', '五', '六'];\n\nconst Calendar = p => {\n  _s();\n\n  const props = mergeProps(defaultCalendarProps, p);\n  const [state, setState] = useSetState({\n    currentMonthFirstDay: dayjs().startOf('month'),\n    monthDates: [],\n    // 月日历需要展示的日期 包括前一月 当月 下一月\n    currentWeekFirstDay: dayjs().startOf('week'),\n    weekDates: [],\n    // 周日历需要展示的日期  包括前一周 当周 下一周\n    currentDate: dayjs(),\n    touch: {\n      x: 0,\n      y: 0\n    },\n    translateIndex: 0,\n    calendarY: 0,\n    // 于Y轴的位置\n    showType: props.showType,\n    isTouching: false\n  }); // 是否拖动中\n\n  const isTouchingRef = useRef(false); // 日历dom\n\n  const calendarRef = useRef(null); // 收起为周视图, 展开为月视图\n\n  const isMonthView = state.showType === 'month'; // 更新日期. 模拟 getDerivedStateFromProps\n\n  useEffect(() => {\n    const dayjsDate = dayjs(props.currentDate);\n    setState({ ...formatMonthDate(dayjsDate),\n      ...formatWeekDate(dayjsDate),\n      currentDate: dayjsDate\n    });\n  }, [props.currentDate, setState]); // 点击选中日期\n\n  const handleDayClick = dayjsDate => {\n    if (dayjs(state.currentDate).isSame(dayjsDate, 'day')) {\n      return;\n    }\n\n    setState({ ...formatMonthDate(dayjsDate),\n      ...formatWeekDate(dayjsDate),\n      currentDate: dayjsDate\n    });\n    props.onDateClick(dayjsDate.toDate());\n  }; // 父容器常规显示指定选中内容y轴高度\n\n\n  const pos = useMemo(() => {\n    var _state$monthDates$;\n\n    if (state.showType === 'month') {\n      return 0;\n    }\n\n    const index = (_state$monthDates$ = state.monthDates[1]) === null || _state$monthDates$ === void 0 ? void 0 : _state$monthDates$.findIndex(item => item.isSame(state.currentDate, 'day'));\n    const pos = Math.floor(index / 7) || 0;\n    return -pos * 42;\n  }, [state.currentDate, state.monthDates, state.showType]); // 父容器位移变化\n\n  const [containerStyle, containerApi] = useSpring(() => ({\n    from: {\n      transform: `translate3d(${-state.translateIndex * 100}%, 0, 0)`,\n      transitionProperty: 'none'\n    },\n    config: {\n      clamp: true,\n      duration: props.transitionDuration,\n      easing: props.easing\n    }\n  })); // 最外层容器高度\n\n  const [heightStyle, heightApi] = useSpring(() => ({\n    from: {\n      height: 46,\n      transitionProperty: 'all'\n    },\n    config: {\n      clamp: true,\n      duration: props.transitionDuration,\n      easing: props.easing\n    }\n  }));\n  const [parentStyle, parentApi] = useSprings(2, i => {\n    if (i === 0) {\n      return {\n        from: {\n          height: 46,\n          transitionProperty: 'all'\n        },\n        config: {\n          clamp: true,\n          duration: props.transitionDuration,\n          easing: props.easing\n        }\n      };\n    }\n\n    return {\n      from: {\n        transform: `translate3d(${-state.translateIndex * 100}%, 0, 0)`,\n        transitionProperty: 'none'\n      },\n      config: {\n        clamp: true,\n        duration: props.transitionDuration,\n        easing: props.easing\n      }\n    };\n  }); // 子容器横向位移\n\n  const [springStyles, springApi] = useSprings(3, i => ({\n    from: {\n      transform: `translate3d(${(i - 1 + state.translateIndex) * 100}%, ${state.calendarY}px, 0)`\n    },\n    config: {\n      clamp: true,\n      duration: props.transitionDuration,\n      easing: props.easing\n    }\n  })); // 父容器位移数字初始化\n\n  useEffect(() => {\n    containerApi.start({\n      to: async next => {\n        await next({\n          transform: `translate3d(${-state.translateIndex * 100}%, ${pos}px, 0)`,\n          transitionProperty: 'none',\n          immediate: true\n        });\n      }\n    });\n  }, [state.translateIndex, containerApi, props.transitionDuration, pos]);\n  useEffect(() => {\n    if (!state.isTouching) return;\n    containerApi.start({\n      to: async next => {\n        await next({\n          transform: `translate3d(${-state.translateIndex * 100}%, 0px, 0)`,\n          transitionProperty: 'none',\n          immediate: true\n        });\n      }\n    });\n  }, [state.isTouching, containerApi, state.translateIndex]); // 横向移动计算\n\n  const runHorizontal = dragState => {\n    var _calendarRef$current;\n\n    const [x] = dragState.movement;\n\n    if (dragState.last) {\n      isTouchingRef.current = false;\n\n      if (Math.abs(x) > 80) {\n        const add = x > 0 ? 1 : -1;\n        springApi.start(i => ({\n          to: async next => {\n            await next({\n              transform: `translate3d(${(i - 1 + state.translateIndex + add) * 100}%, ${state.calendarY}px, 0)`\n            });\n          }\n        }));\n        setState({\n          translateIndex: state.translateIndex + add,\n          isTouching: false\n        });\n\n        if (isMonthView) {\n          const nextMonthFirstDay = state.currentMonthFirstDay[add > 0 ? 'subtract' : 'add'](1, 'month');\n          handleDayClick(nextMonthFirstDay);\n        } else {\n          const nextWeekFirstDay = state.currentWeekFirstDay[add > 0 ? 'subtract' : 'add'](1, 'week');\n          handleDayClick(nextWeekFirstDay);\n        }\n      } else {\n        springApi.start(i => ({\n          to: async next => {\n            await next({\n              transform: `translate3d(${(i - 1 + state.translateIndex) * 100}%, ${state.calendarY}px, 0)`\n            });\n          }\n        }));\n      }\n\n      return;\n    }\n\n    const width = ((_calendarRef$current = calendarRef.current) === null || _calendarRef$current === void 0 ? void 0 : _calendarRef$current.offsetWidth) || 1;\n    const xPersent = x / width;\n    springApi.start(i => ({\n      transform: `translate3d(${(i - 1 + state.translateIndex + xPersent) * 100}%, ${state.calendarY}px, 0)`,\n      immediate: true\n    }));\n  }; // 纵向移动计算\n\n\n  const runVertical = dragState => {\n    const [, y] = dragState.movement;\n    const height = isMonthView ? 260 : 46;\n\n    if (dragState.last) {\n      if (Math.abs(y) > 50) {\n        if (y > 0) {\n          handleShowTypeToggle('month');\n        } else {\n          handleShowTypeToggle('week');\n        }\n      } else {\n        heightApi.start({\n          to: async next => {\n            await next({\n              height: height,\n              immediate: false\n            });\n          }\n        });\n        containerApi.start({\n          to: async next => {\n            await next({\n              transform: `translate3d(${-state.translateIndex * 100}%, ${isMonthView ? 0 : pos}px, 0)`,\n              immediate: false\n            });\n          }\n        });\n      }\n\n      return;\n    }\n\n    if (height + y > 260 || height + y < 46) {\n      return;\n    }\n\n    if (isMonthView) {\n      heightApi.start({\n        to: async next => {\n          await next({\n            height: Math.min(height + y, 260),\n            transitionProperty: 'none',\n            immediate: true\n          });\n        }\n      });\n      containerApi.start({\n        to: async next => {\n          await next({\n            transform: `translate3d(${-state.translateIndex * 100}%, ${Math.max(pos, y * 0.7)}px, 0)`,\n            transitionProperty: 'none',\n            immediate: true\n          });\n        }\n      });\n    } else {\n      heightApi.start({\n        to: async next => {\n          await next({\n            height: Math.max(height + y, 46),\n            immediate: true\n          });\n        }\n      });\n      containerApi.start({\n        to: async next => {\n          await next({\n            transform: `translate3d(${-state.translateIndex * 100}%, ${Math.min(pos + y * 0.7, 0)}px, 0)`,\n            transitionProperty: 'none',\n            immediate: true\n          });\n        }\n      });\n    }\n  }; // 拖动, 周末式切换的时候, 需要用星期来展示列表\n\n\n  useDrag(dragState => {\n    dragState.event.stopPropagation();\n\n    if (dragState.first) {\n      isTouchingRef.current = true;\n    }\n\n    if (dragState.axis === 'x') {\n      if (!isMonthView && !state.isTouching) {\n        setState({\n          isTouching: true\n        });\n      }\n\n      runHorizontal(dragState);\n    }\n\n    if (dragState.axis === 'y') {\n      runVertical(dragState);\n    }\n  }, {\n    pointer: {\n      touch: true\n    },\n    target: calendarRef,\n    eventOptions: {\n      passive: false\n    }\n  }); // 切换模式\n\n  const handleShowTypeToggle = type => {\n    const targetType = type ? type : state.showType === 'week' ? 'month' : 'week';\n    heightApi.start({\n      to: async next => {\n        await next({\n          height: targetType === 'week' ? 46 : 260,\n          transitionProperty: 'all',\n          immediate: false\n        });\n      }\n    });\n    containerApi.start({\n      to: async next => {\n        await next({\n          transform: `translate3d(${-state.translateIndex * 100}%, ${targetType === 'week' ? pos : 0}px, 0)`,\n          transitionProperty: 'all',\n          immediate: false\n        });\n        setState({\n          showType: targetType\n        });\n      }\n    });\n  }; // 格式化日期显示\n\n\n  const formatDay = date => {\n    if (dayjs().isSame(date, 'day')) {\n      return /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: '#3388FF'\n        },\n        children: \"\\u4ECA\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 434,\n        columnNumber: 20\n      }, this);\n    } // 'YYYY-MM-DD HH:mm:ss'\n\n\n    return dayjs(date).format('D');\n  };\n\n  const dayCellRender = function (date, index) {\n    let showGray = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    // 选中日期\n    const isCurrentDay = date.isSame(state.currentDate, 'day'); // 其它月的日期, 在星期的模式下不显示置灰\n\n    const isOtherMonthDay = showGray && !date.isSame(state.currentMonthFirstDay, 'month'); // 是否为标志过的日期\n\n    const isMarkDate = props.markDates.find(d => date.isSame(d, 'day'));\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: cn('day-cell', {\n        'is-other-month-day': isOtherMonthDay,\n        'current-day': isCurrentDay\n      }),\n      onClick: () => handleDayClick(date),\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"day-text\",\n        children: formatDay(date)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 456,\n        columnNumber: 17\n      }, _this), isMarkDate && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"dot-mark\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 457,\n        columnNumber: 32\n      }, _this)]\n    }, index, true, {\n      fileName: _jsxFileName,\n      lineNumber: 449,\n      columnNumber: 13\n    }, _this);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"react-mob-calendar\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"calendar-operate\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: formatMonthYear(state.currentDate)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 466,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"calendar-head\",\n      children: head.map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"head-cell\",\n        children: i\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 472,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(animated.div, {\n      className: cn('calendar-body', {\n        'week-mode': isMonthView\n      }),\n      style: heightStyle,\n      ref: calendarRef,\n      children: [/*#__PURE__*/_jsxDEV(animated.div, {\n        style: containerStyle,\n        children: [springStyles.map((style, i) => {\n          var _state$monthDates$i;\n\n          return /*#__PURE__*/_jsxDEV(animated.div, {\n            className: cn('month-cell', {\n              'is-hidden': !isMonthView && state.isTouching\n            }),\n            style: style,\n            children: (_state$monthDates$i = state.monthDates[i]) === null || _state$monthDates$i === void 0 ? void 0 : _state$monthDates$i.map((day, index) => dayCellRender(day, index, i === 1))\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 29\n          }, this);\n        }), springStyles.map((style, i) => {\n          var _state$weekDates$i;\n\n          return /*#__PURE__*/_jsxDEV(animated.div, {\n            className: cn('month-cell', {\n              'is-hidden': !(!isMonthView && state.isTouching)\n            }),\n            style: style,\n            children: (_state$weekDates$i = state.weekDates[i]) === null || _state$weekDates$i === void 0 ? void 0 : _state$weekDates$i.map((day, index) => dayCellRender(day, index))\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 503,\n            columnNumber: 29\n          }, this);\n        })]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 483,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bottom-operate\",\n        children: !props.disabledMonthView && /*#__PURE__*/_jsxDEV(\"div\", {\n          role: \"presentation\",\n          onClick: () => handleShowTypeToggle(),\n          className: \"bottom-operate-btn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 520,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 479,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 463,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Calendar, \"641qkVQRYSCGBLvlZwhh9JQqWik=\", false, function () {\n  return [useSetState, useSpring, useSpring, useSprings, useSprings, useDrag];\n});\n\n_c = Calendar;\nexport default Calendar;\n\nvar _c;\n\n$RefreshReg$(_c, \"Calendar\");","map":{"version":3,"sources":["/Users/alian/Desktop/git-source/react-mob-calendar/src/components/calendar/Calendar.tsx"],"names":["React","useEffect","useRef","useMemo","dayjs","cn","animated","useSpring","useSprings","easings","useDrag","formatMonthDate","formatWeekDate","formatMonthYear","mergeProps","useSetState","defaultFunc","defaultCalendarProps","currentDate","Date","showType","transitionDuration","onDateClick","onTouchStart","onTouchMove","onTouchEnd","onToggleShowType","markDates","easing","easeInOutCirc","head","Calendar","p","props","state","setState","currentMonthFirstDay","startOf","monthDates","currentWeekFirstDay","weekDates","touch","x","y","translateIndex","calendarY","isTouching","isTouchingRef","calendarRef","isMonthView","dayjsDate","handleDayClick","isSame","toDate","pos","index","findIndex","item","Math","floor","containerStyle","containerApi","from","transform","transitionProperty","config","clamp","duration","heightStyle","heightApi","height","parentStyle","parentApi","i","springStyles","springApi","start","to","next","immediate","runHorizontal","dragState","movement","last","current","abs","add","nextMonthFirstDay","nextWeekFirstDay","width","offsetWidth","xPersent","runVertical","handleShowTypeToggle","min","max","event","stopPropagation","first","axis","pointer","target","eventOptions","passive","type","targetType","formatDay","date","color","format","dayCellRender","showGray","isCurrentDay","isOtherMonthDay","isMarkDate","find","d","map","style","day","disabledMonthView"],"mappings":"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","sourcesContent":["/* eslint-disable react/destructuring-assignment */\n/**\n * 日视图/列表视图 日历\n */\nimport React, { FC, useEffect, useRef, useMemo } from 'react';\nimport dayjs, { Dayjs } from 'dayjs';\nimport cn from 'classnames';\nimport { animated, useSpring, useSprings, easings } from '@react-spring/web';\nimport { useDrag, FullGestureState } from '@use-gesture/react';\n\nimport {\n    formatMonthDate,\n    formatWeekDate,\n    formatMonthYear,\n    mergeProps,\n} from '../../utils/index';\n\nimport { useSetState } from '../../utils/hooks';\n\nexport type CalendarProps = {\n    // 选中日期\n    currentDate?: Date;\n    // 展示方式\n    showType?: 'week' | 'month';\n    // 动画时间\n    transitionDuration?: number;\n    // 点击选中日期\n    onDateClick?: Function;\n    // 拖动开始\n    onTouchStart?: Function;\n    // 拖动过程\n    onTouchMove?: Function;\n    // 拖动结束\n    onTouchEnd?: (start: number, end: number) => void;\n    // 更换视图模式\n    onToggleShowType?: Function;\n    // 标记日期\n    markDates?: Date[];\n    // 禁用月视图\n    disabledMonthView?: boolean;\n    // 变化趋势\n    easing?: typeof easings\n};\n\nconst defaultFunc = (...rest: any) => {\n    // console.log('default function:', rest);\n};\n\nconst defaultCalendarProps = {\n    currentDate: new Date(),\n    showType: 'week',\n    transitionDuration: 3000,\n    onDateClick: defaultFunc,\n    onTouchStart: defaultFunc,\n    onTouchMove: defaultFunc,\n    onTouchEnd: defaultFunc,\n    onToggleShowType: defaultFunc,\n    markDates: [],\n    easing: easings.easeInOutCirc\n};\n\ntype DragType = Omit<FullGestureState<'drag'>, 'event'> & {\n    event: PointerEvent | MouseEvent | globalThis.TouchEvent | KeyboardEvent;\n};\n\ntype StateValue = {\n    currentMonthFirstDay: Dayjs;\n    monthDates: Dayjs[][];\n    currentWeekFirstDay: Dayjs;\n    weekDates: Dayjs[][];\n    currentDate: Dayjs;\n    touch: { x: number; y: number };\n    translateIndex: number;\n    calendarY: number;\n    showType: CalendarProps['showType'];\n    isTouching: boolean;\n};\n\nconst head = ['日', '一', '二', '三', '四', '五', '六'];\n\nconst Calendar: FC<CalendarProps> = p => {\n    const props = mergeProps(defaultCalendarProps, p);\n\n    const [state, setState] = useSetState<StateValue>({\n        currentMonthFirstDay: dayjs().startOf('month'),\n        monthDates: [], // 月日历需要展示的日期 包括前一月 当月 下一月\n        currentWeekFirstDay: dayjs().startOf('week'),\n        weekDates: [], // 周日历需要展示的日期  包括前一周 当周 下一周\n        currentDate: dayjs(),\n        touch: { x: 0, y: 0 },\n        translateIndex: 0,\n        calendarY: 0, // 于Y轴的位置\n        showType: props.showType,\n        isTouching: false,\n    });\n\n    // 是否拖动中\n    const isTouchingRef = useRef(false);\n    // 日历dom\n    const calendarRef = useRef<HTMLDivElement>(null);\n\n    // 收起为周视图, 展开为月视图\n    const isMonthView = state.showType === 'month';\n\n    // 更新日期. 模拟 getDerivedStateFromProps\n    useEffect(() => {\n        const dayjsDate = dayjs(props.currentDate);\n        setState({\n            ...formatMonthDate(dayjsDate),\n            ...formatWeekDate(dayjsDate),\n            currentDate: dayjsDate,\n        });\n    }, [props.currentDate, setState]);\n\n    // 点击选中日期\n    const handleDayClick = (dayjsDate: Dayjs) => {\n        if (dayjs(state.currentDate).isSame(dayjsDate, 'day')) {\n            return;\n        }\n        setState({\n            ...formatMonthDate(dayjsDate),\n            ...formatWeekDate(dayjsDate),\n            currentDate: dayjsDate,\n        });\n        props.onDateClick(dayjsDate.toDate());\n    };\n\n    // 父容器常规显示指定选中内容y轴高度\n    const pos = useMemo(() => {\n        if(state.showType === 'month') {\n            return 0\n        }\n        const index = state.monthDates[1]?.findIndex(item =>\n            item.isSame(state.currentDate, 'day')\n        );\n        const pos = Math.floor(index / 7) || 0;\n        return -pos * 42;\n    }, [state.currentDate, state.monthDates, state.showType]);\n\n    // 父容器位移变化\n    const [containerStyle, containerApi] = useSpring(() => ({\n        from: {\n            transform: `translate3d(${-state.translateIndex * 100}%, 0, 0)`,\n            transitionProperty: 'none',\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    // 最外层容器高度\n    const [heightStyle, heightApi] = useSpring(() => ({\n        from: {\n            height: 46,\n            transitionProperty: 'all',\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    const [parentStyle, parentApi] = useSprings(2, i => {\n        if(i===0) {\n            return {\n                from: {\n                    height: 46,\n                    transitionProperty: 'all',\n                },\n                config: {\n                    clamp: true,\n                    duration: props.transitionDuration,\n                    easing: props.easing,\n                },\n            }\n        }\n        return {\n            from: {\n                transform: `translate3d(${-state.translateIndex * 100}%, 0, 0)`,\n                transitionProperty: 'none',\n            },\n            config: {\n                clamp: true,\n                duration: props.transitionDuration,\n                easing: props.easing,\n            },\n        }\n    })\n\n    // 子容器横向位移\n    const [springStyles, springApi] = useSprings(3, i => ({\n        from: {\n            transform: `translate3d(${(i - 1 + state.translateIndex) * 100}%, ${\n                state.calendarY\n            }px, 0)`,\n        },\n        config: {\n            clamp: true,\n            duration: props.transitionDuration,\n            easing: props.easing,\n        },\n    }));\n\n    // 父容器位移数字初始化\n    useEffect(() => {\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${-state.translateIndex * 100}%, ${pos}px, 0)`,\n                    transitionProperty: 'none',\n                    immediate: true,\n                });\n            },\n        });\n    }, [\n        state.translateIndex,\n        containerApi,\n        props.transitionDuration,\n        pos,\n    ]);\n\n    useEffect(() => {\n        if (!state.isTouching) return;\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${\n                        -state.translateIndex * 100\n                    }%, 0px, 0)`,\n                    transitionProperty: 'none',\n                    immediate: true,\n                });\n            },\n        });\n    }, [state.isTouching, containerApi, state.translateIndex]);\n    // 横向移动计算\n    const runHorizontal = (dragState: DragType) => {\n        const [x] = dragState.movement;\n        if (dragState.last) {\n            isTouchingRef.current = false;\n            if (Math.abs(x) > 80) {\n                const add = x > 0 ? 1 : -1;\n                springApi.start(i => ({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                (i - 1 + state.translateIndex + add) * 100\n                            }%, ${state.calendarY}px, 0)`,\n                        });\n                    },\n                }));\n                setState({\n                    translateIndex: state.translateIndex + add,\n                    isTouching: false,\n                });\n                if (isMonthView) {\n                    const nextMonthFirstDay = state.currentMonthFirstDay[\n                        add > 0 ? 'subtract' : 'add'\n                    ](1, 'month');\n                    handleDayClick(nextMonthFirstDay);\n                } else {\n                    const nextWeekFirstDay = state.currentWeekFirstDay[\n                        add > 0 ? 'subtract' : 'add'\n                    ](1, 'week');\n                    handleDayClick(nextWeekFirstDay);\n                }\n            } else {\n                springApi.start(i => ({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                (i - 1 + state.translateIndex) * 100\n                            }%, ${state.calendarY}px, 0)`,\n                        });\n                    },\n                }));\n            }\n            return;\n        }\n        const width = calendarRef.current?.offsetWidth || 1;\n        const xPersent = x / width;\n        springApi.start(i => ({\n            transform: `translate3d(${\n                (i - 1 + state.translateIndex + xPersent) * 100\n            }%, ${state.calendarY}px, 0)`,\n            immediate: true,\n        }));\n    };\n\n    // 纵向移动计算\n    const runVertical = (dragState: DragType) => {\n        const [, y] = dragState.movement;\n        const height = isMonthView ? 260 : 46;\n        if (dragState.last) {\n            if (Math.abs(y) > 50) {\n                if (y > 0) {\n                    handleShowTypeToggle('month');\n                } else {\n                    handleShowTypeToggle('week');\n                }\n            } else {\n                heightApi.start({\n                    to: async next => {\n                        await next({\n                            height: height,\n                            immediate: false,\n                        });\n                    },\n                });\n                containerApi.start({\n                    to: async next => {\n                        await next({\n                            transform: `translate3d(${\n                                -state.translateIndex * 100\n                            }%, ${isMonthView ? 0 : pos}px, 0)`,\n                            immediate: false,\n                        });\n                    },\n                });\n            }\n            return;\n        }\n        if (height + y > 260 || height + y < 46) {\n            return;\n        }\n        if (isMonthView) {\n            heightApi.start({\n                to: async next => {\n                    await next({\n                        height: Math.min(height + y, 260),\n                        transitionProperty: 'none',\n                        immediate: true,\n                    });\n                },\n            });\n            containerApi.start({\n                to: async next => {\n                    await next({\n                        transform: `translate3d(${\n                            -state.translateIndex * 100\n                        }%, ${Math.max(pos, y * 0.7)}px, 0)`,\n                        transitionProperty: 'none',\n                        immediate: true,\n                    });\n                },\n            });\n        } else {\n            heightApi.start({\n                to: async next => {\n                    await next({\n                        height: Math.max(height + y, 46),\n                        immediate: true,\n                    });\n                },\n            });\n            containerApi.start({\n                to: async next => {\n                    await next({\n                        transform: `translate3d(${\n                            -state.translateIndex * 100\n                        }%, ${Math.min(pos + y * 0.7, 0)}px, 0)`,\n                        transitionProperty: 'none',\n                        immediate: true,\n                    });\n                },\n            });\n        }\n    };\n\n    // 拖动, 周末式切换的时候, 需要用星期来展示列表\n    useDrag(\n        dragState => {\n            dragState.event.stopPropagation();\n            if (dragState.first) {\n                isTouchingRef.current = true;\n            }\n\n            if (dragState.axis === 'x') {\n                if (!isMonthView && !state.isTouching) {\n                    setState({ isTouching: true });\n                }\n                runHorizontal(dragState);\n            }\n\n            if (dragState.axis === 'y') {\n                runVertical(dragState);\n            }\n        },\n        {\n            pointer: { touch: true },\n            target: calendarRef,\n            eventOptions: { passive: false },\n        }\n    );\n\n    // 切换模式\n    const handleShowTypeToggle = (type?: 'week' | 'month') => {\n        const targetType = type\n            ? type\n            : state.showType === 'week'\n            ? 'month'\n            : 'week';\n        heightApi.start({\n            to: async next => {\n                await next({\n                    height: targetType === 'week' ? 46 : 260,\n                    transitionProperty: 'all',\n                    immediate: false,\n                });\n            },\n        });\n        containerApi.start({\n            to: async next => {\n                await next({\n                    transform: `translate3d(${-state.translateIndex * 100}%, ${\n                        targetType === 'week' ? pos : 0\n                    }px, 0)`,\n                    transitionProperty: 'all',\n                    immediate: false,\n                });\n                setState({\n                    showType: targetType,\n                });\n            },\n        });\n    };\n\n    // 格式化日期显示\n    const formatDay = (date: Dayjs) => {\n        if (dayjs().isSame(date, 'day')) {\n            return <span style={{ color: '#3388FF' }}>今</span>;\n        }\n        // 'YYYY-MM-DD HH:mm:ss'\n        return dayjs(date).format('D');\n    };\n\n    const dayCellRender = (date: Dayjs, index: number, showGray = false) => {\n        // 选中日期\n        const isCurrentDay = date.isSame(state.currentDate, 'day');\n        // 其它月的日期, 在星期的模式下不显示置灰\n        const isOtherMonthDay =\n            showGray && !date.isSame(state.currentMonthFirstDay, 'month');\n        // 是否为标志过的日期\n        const isMarkDate = props.markDates.find(d => date.isSame(d, 'day'));\n        return (\n            <div\n                key={index}\n                className={cn('day-cell', {\n                    'is-other-month-day': isOtherMonthDay,\n                    'current-day': isCurrentDay,\n                })}\n                onClick={() => handleDayClick(date)}>\n                <div className='day-text'>{formatDay(date)}</div>\n                {isMarkDate && <div className='dot-mark' />}\n            </div>\n        );\n    };\n\n    return (\n        <div className='react-mob-calendar'>\n            {/* 年月 */}\n            <div className='calendar-operate'>\n                <div>{formatMonthYear(state.currentDate)}</div>\n            </div>\n\n            {/* 星期 */}\n            <div className='calendar-head'>\n                {head.map(i => (\n                    <div className='head-cell' key={i}>\n                        {i}\n                    </div>\n                ))}\n            </div>\n\n            {/* 日期表格 */}\n            <animated.div\n                className={cn('calendar-body', { 'week-mode': isMonthView })}\n                style={heightStyle}\n                ref={calendarRef}>\n                <animated.div style={containerStyle}>\n                    {/* 月视图 */}\n                    {springStyles.map((style, i) => {\n                        return (\n                            <animated.div\n                                className={cn('month-cell', {\n                                    'is-hidden':\n                                        !isMonthView && state.isTouching,\n                                })}\n                                key={i}\n                                style={style}>\n                                {state.monthDates[i]?.map((day, index) =>\n                                    dayCellRender(day, index, i===1)\n                                )}\n                            </animated.div>\n                        );\n                    })}\n                    {/* 周视图 */}\n                    {springStyles.map((style, i) => {\n                        return (\n                            <animated.div\n                                className={cn('month-cell', {\n                                    'is-hidden': !(\n                                        !isMonthView && state.isTouching\n                                    ),\n                                })}\n                                key={i}\n                                style={style}>\n                                {state.weekDates[i]?.map((day, index) =>\n                                    dayCellRender(day, index)\n                                )}\n                            </animated.div>\n                        );\n                    })}\n                </animated.div>\n                <div className='bottom-operate'>\n                    {!props.disabledMonthView && (\n                        <div\n                            role='presentation'\n                            onClick={() => handleShowTypeToggle()}\n                            className='bottom-operate-btn'\n                        />\n                    )}\n                </div>\n            </animated.div>\n        </div>\n    );\n};\n\nexport default Calendar;\n"]},"metadata":{},"sourceType":"module"}