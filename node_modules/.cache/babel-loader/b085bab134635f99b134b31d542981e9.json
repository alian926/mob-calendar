{"ast":null,"code":"var _jsxFileName = \"/Users/alian/Desktop/git-source/react-mob-calendar/src/components/calendar/Calendar.tsx\",\n    _s = $RefreshSig$();\n\n/* eslint-disable react/destructuring-assignment */\n\n/**\n * 日视图/列表视图 日历\n */\nimport React, { useEffect, useRef } from 'react';\nimport dayjs from 'dayjs';\nimport throttle from 'lodash/throttle';\nimport cn from 'classnames';\nimport { animated, useSprings } from '@react-spring/web';\nimport { useDrag } from '@use-gesture/react';\nimport { formatMonthData, formatWeekData, formatMonthYear, mergeProps } from '../../utils/index';\nimport { useSetState } from '../../utils/hooks';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst defaultFunc = function () {// console.log('default function:', rest);\n};\n\nconst defaultCalendarProps = {\n  currentDate: new Date(),\n  showType: 'week',\n  transitionDuration: 0.3,\n  onDateClick: defaultFunc,\n  onTouchStart: defaultFunc,\n  onTouchMove: defaultFunc,\n  onTouchEnd: defaultFunc,\n  onToggleShowType: defaultFunc,\n  markDates: []\n};\n\nconst Calendar = p => {\n  _s();\n\n  const props = mergeProps(defaultCalendarProps, p);\n  const [state, setState] = useSetState({\n    currentMonthFirstDay: dayjs().startOf('month'),\n    monthDates: [],\n    // 月日历需要展示的日期 包括前一月 当月 下一月\n    currentWeekFirstDay: dayjs().startOf('week'),\n    weekDates: [],\n    // 周日历需要展示的日期  包括前一周 当周 下一周\n    currentDate: dayjs(),\n    touch: {\n      x: 0,\n      y: 0\n    },\n    translateIndex: 0,\n    calendarY: 0,\n    // 于Y轴的位置\n    showType: props.showType\n  }); // 是否拖动中\n\n  const isTouchingRef = useRef(false); // 拖动起始横坐标\n\n  const touchStartPositionXRef = useRef(0); // 拖动起始纵坐标\n\n  const touchStartPositionYRef = useRef(0); // 日历dom\n\n  const calendarRef = useRef(null);\n  const {\n    monthDates,\n    weekDates,\n    touch,\n    translateIndex,\n    calendarY,\n    currentMonthFirstDay,\n    currentWeekFirstDay,\n    showType\n  } = state; // 更新日期. 模拟 getDerivedStateFromProps\n\n  useEffect(() => {\n    const dayjsDate = dayjs(props.currentDate);\n    setState({ ...formatMonthData(dayjsDate),\n      ...formatWeekData(dayjsDate),\n      currentDate: dayjsDate\n    });\n  }, [props.currentDate, setState]); // 点击选中日期\n\n  const handleDayClick = date => {\n    if (dayjs(state.currentDate).isSame(date, 'day')) {\n      return;\n    }\n\n    setState({ ...formatMonthData(date),\n      ...formatWeekData(date),\n      currentDate: date\n    });\n    props.onDateClick(date.toDate());\n  };\n\n  const [springStyles, springApi] = useSprings(3, i => ({\n    from: {\n      transform: `translate3d(${(i - 1 + state.translateIndex + (isTouchingRef.current ? state.touch.x : 0)) * 100}%, ${calendarY}px, 0)`,\n      transitionDuration: `${props.transitionDuration}s`\n    },\n    config: {\n      tension: 300,\n      friction: 30,\n      clamp: true\n    }\n  }));\n\n  const runHorizontal = dragState => {\n    var _calendarRef$current;\n\n    if (dragState.last) {\n      isTouchingRef.current = false;\n      const [distance] = dragState.distance;\n\n      if (distance > 50) {\n        const [direction] = dragState.direction;\n        springApi.start(i => ({\n          to: async next => {\n            // await next({\n            //     transform: `translate3d(${\n            //         (i - 1 + state.translateIndex - direction) * 100\n            //     }%, ${calendarY}px, 0)`,\n            //     transitionDuration: `${props.transitionDuration}s`,\n            // });\n            // await next({\n            //     transitionDuration: `0s`,\n            //     immediate: true,\n            // });\n            const nextWeekFirstDay = currentWeekFirstDay[direction > 0 ? 'subtract' : 'add'](1, 'week');\n            setState({\n              translateIndex: state.translateIndex - direction\n            });\n            handleDayClick(nextWeekFirstDay);\n          }\n        }));\n      }\n\n      return;\n    }\n\n    const [x] = dragState.movement;\n    const width = ((_calendarRef$current = calendarRef.current) === null || _calendarRef$current === void 0 ? void 0 : _calendarRef$current.offsetWidth) || 1;\n    const xPersent = x / width;\n    springApi.start(i => ({\n      transform: `translate3d(${(i - 1 + state.translateIndex + (isTouchingRef.current ? xPersent : 0)) * 100}%, ${calendarY}px, 0)`,\n      transitionDuration: `0s`,\n      immediate: true\n    }));\n  };\n\n  useDrag(state => {\n    state.event.stopPropagation();\n\n    if (state.first) {\n      isTouchingRef.current = true;\n    }\n\n    if (state.axis === 'x') {\n      runHorizontal(state);\n    }\n\n    console.log('%c 2022-01-26, 131-info: state', 'color: fuchsia; background: Aquamarine; font-size: 20px;', state); // Alian-log\n  }, {\n    pointer: {\n      touch: true\n    },\n    target: calendarRef,\n    eventOptions: {\n      passive: false\n    }\n  });\n  const handleTouchMove = throttle(e => {\n    var _calendarRef$current2, _calendarRef$current3;\n\n    e.stopPropagation();\n    const moveX = e.touches[0].clientX - touchStartPositionXRef.current;\n    const moveY = e.touches[0].clientY - touchStartPositionYRef.current;\n    const calendarWidth = ((_calendarRef$current2 = calendarRef.current) === null || _calendarRef$current2 === void 0 ? void 0 : _calendarRef$current2.offsetWidth) || 0;\n    const calendarHeight = ((_calendarRef$current3 = calendarRef.current) === null || _calendarRef$current3 === void 0 ? void 0 : _calendarRef$current3.offsetHeight) || 0;\n\n    if (Math.abs(moveX) > Math.abs(moveY)) {\n      // 左右滑动\n      setState({\n        touch: {\n          x: moveX / calendarWidth,\n          y: 0\n        }\n      });\n    } else if (!props.disabledMonthView) {\n      setState({\n        touch: {\n          x: 0,\n          y: moveY / calendarHeight\n        }\n      });\n    }\n\n    props.onTouchMove(e);\n  }, 25);\n\n  const handleTouchStart = e => {\n    e.stopPropagation();\n    touchStartPositionXRef.current = e.touches[0].clientX;\n    touchStartPositionYRef.current = e.touches[0].clientY;\n    isTouchingRef.current = true;\n    props.onTouchStart(e);\n  };\n\n  const handleTouchEnd = e => {\n    var _calendarRef$current4;\n\n    e.stopPropagation();\n    const calendarHeight = ((_calendarRef$current4 = calendarRef.current) === null || _calendarRef$current4 === void 0 ? void 0 : _calendarRef$current4.offsetHeight) || 0;\n    isTouchingRef.current = false;\n    const absTouchX = Math.abs(touch.x);\n    const absTouchY = Math.abs(touch.y);\n\n    if (absTouchX > absTouchY && absTouchX > 0.15) {\n      const isMonthView = showType === 'month'; // touch.x > 0 右滑 日期减少, 回到上个月, translateIndex变大 向右偏移\n\n      const newTranslateIndex = touch.x > 0 ? translateIndex + 1 : translateIndex - 1;\n\n      if (isMonthView) {\n        // 月视图\n        const nextMonthFirstDay = currentMonthFirstDay[touch.x > 0 ? 'subtract' : 'add'](1, 'month'); // const nextMonthStartDay = nextMonthFirstDay.startOf('week');\n        // const nextMonthEndDay = nextMonthStartDay.add(42, 'day');\n\n        setState({\n          translateIndex: newTranslateIndex,\n          ...formatMonthData(nextMonthFirstDay)\n        });\n        handleDayClick(nextMonthFirstDay); // onTouchEnd(nextMonthStartDay.valueOf(), nextMonthEndDay.valueOf());\n      } else {\n        // 周视图\n        const nexCurrentDay = dayjs(state.currentDate)[touch.x > 0 ? 'subtract' : 'add'](1, 'week');\n        const nextWeekFirstDay = currentWeekFirstDay[touch.x > 0 ? 'subtract' : 'add'](1, 'week'); // const nextWeekLastDay = nextWeekFirstDay.add(7, 'day');\n\n        setState({\n          translateIndex: newTranslateIndex,\n          ...formatWeekData(nextWeekFirstDay)\n        });\n        handleDayClick(nexCurrentDay); // onTouchEnd(nextWeekFirstDay.valueOf(), nextWeekLastDay.valueOf());\n      }\n    } else if (absTouchY > absTouchX && Math.abs(touch.y * calendarHeight) > 50) {\n      if (props.disabledMonthView) {// 禁用周视图\n      } else if (touch.y > 0 && showType === 'week') {\n        setState({\n          showType: 'month'\n        }); // const cb = () => {\n        //     const dataArray = state.weekDates[1];\n        //     onToggleShowType({\n        //         showType: state.showType,\n        //         startTime: dataArray[0].valueOf(),\n        //         endTime: dataArray[dataArray.length - 1].add(1, 'day').valueOf()\n        //     });\n        // };\n        // cb();\n      } else if (touch.y < 0 && showType === 'month') {\n        setState({\n          showType: 'week'\n        }); // const cb = () => {\n        //     const dataArray = state.weekDates[1];\n        //     onToggleShowType({\n        //         showType: state.showType,\n        //         startTime: dataArray[0].valueOf(),\n        //         endTime: dataArray[dataArray.length - 1].add(1, 'day').valueOf()\n        //     });\n        // };\n        // cb();\n      }\n    }\n\n    setState({\n      touch: {\n        x: 0,\n        y: 0\n      }\n    });\n  };\n\n  const handleShowTypeToggle = () => {\n    setState({\n      showType: showType === 'month' ? 'week' : 'month'\n    });\n  }; // 可以通过此函数 实现 点击按钮 进行月份切换\n\n\n  const handleMonthToggle = type => {\n    const {\n      currentMonthFirstDay,\n      currentWeekFirstDay,\n      showType\n    } = state;\n    const isMonthView = showType === 'month';\n    const isPrev = type === 'prev';\n    const formatFun = isMonthView ? formatMonthData : formatWeekData;\n    const operateDate = isMonthView ? currentMonthFirstDay : currentWeekFirstDay;\n    const updateStateData = formatFun(operateDate[isPrev ? 'subtract' : 'add'](1, isMonthView ? 'month' : 'week'));\n    setState(updateStateData); // const cb = () => {\n    //     const dataArray = updateStateData[isMonthView ? 'monthDates' : 'weekDates'][1];\n    //     onTouchEnd(dataArray[0].valueOf(), dataArray[dataArray.length - 1].add(1, 'day').valueOf());\n    // };\n    // cb();\n  }; // 收起为周视图, 展开为月视图\n\n\n  const isMonthView = showType === 'month'; // 格式化日期显示\n\n  const formatDay = date => {\n    if (dayjs().isSame(date, 'day')) {\n      return /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          color: '#3388FF'\n        },\n        children: \"\\u4ECA\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 20\n      }, this);\n    } // 'YYYY-MM-DD HH:mm:ss'\n\n\n    return dayjs(date).format('D');\n  };\n\n  const head = ['日', '一', '二', '三', '四', '五', '六'];\n  const calendarBodyHeight = (isMonthView ? 252 : 38) + 8;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"react-mob-calendar\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"calendar-operate\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        children: formatMonthYear(state.currentDate)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 365,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"calendar-head\",\n      children: head.map(i => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"head-cell\",\n        children: i\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 21\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 369,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: cn('calendar-body', {\n        'week-mode': isMonthView\n      }),\n      style: {\n        height: calendarBodyHeight\n      },\n      ref: calendarRef,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          transform: `translate3d(${-translateIndex * 100}%, 0, 0)`\n        },\n        children: springStyles.map((style, i) => {\n          var _dateList$i;\n\n          const dateList = isMonthView ? monthDates : weekDates;\n          return /*#__PURE__*/_jsxDEV(animated.div, {\n            className: \"month-cell\",\n            style: style,\n            children: (_dateList$i = dateList[i]) === null || _dateList$i === void 0 ? void 0 : _dateList$i.map((date, index) => {\n              // 选中日期\n              const isCurrentDay = date.isSame(state.currentDate, 'day'); // 其它月的日期, 在星期的模式下不显示置灰\n\n              const isOtherMonthDay = showType === 'week' ? false : !date.isSame(currentMonthFirstDay, 'month'); // 是否为标志过的日期\n\n              const isMarkDate = props.markDates.find(d => date.isSame(d, 'day'));\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: cn('day-cell', {\n                  'is-other-month-day': isOtherMonthDay,\n                  'current-day': isCurrentDay\n                }),\n                onClick: () => handleDayClick(date),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"day-text\",\n                  children: formatDay(date)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 425,\n                  columnNumber: 45\n                }, this), isMarkDate && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"dot-mark\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 429,\n                  columnNumber: 49\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 415,\n                columnNumber: 41\n              }, this);\n            })\n          }, i, false, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 29\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bottom-operate\",\n        children: !props.disabledMonthView && /*#__PURE__*/_jsxDEV(\"div\", {\n          role: \"presentation\",\n          onClick: handleShowTypeToggle,\n          className: \"bottom-operate-btn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 378,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 362,\n    columnNumber: 9\n  }, this);\n};\n\n_s(Calendar, \"AVRXdFacaDLJHjRnNy8bSgBokLU=\", false, function () {\n  return [useSetState, useSprings, useDrag];\n});\n\n_c = Calendar;\nexport default Calendar;\n\nvar _c;\n\n$RefreshReg$(_c, \"Calendar\");","map":{"version":3,"sources":["/Users/alian/Desktop/git-source/react-mob-calendar/src/components/calendar/Calendar.tsx"],"names":["React","useEffect","useRef","dayjs","throttle","cn","animated","useSprings","useDrag","formatMonthData","formatWeekData","formatMonthYear","mergeProps","useSetState","defaultFunc","defaultCalendarProps","currentDate","Date","showType","transitionDuration","onDateClick","onTouchStart","onTouchMove","onTouchEnd","onToggleShowType","markDates","Calendar","p","props","state","setState","currentMonthFirstDay","startOf","monthDates","currentWeekFirstDay","weekDates","touch","x","y","translateIndex","calendarY","isTouchingRef","touchStartPositionXRef","touchStartPositionYRef","calendarRef","dayjsDate","handleDayClick","date","isSame","toDate","springStyles","springApi","i","from","transform","current","config","tension","friction","clamp","runHorizontal","dragState","last","distance","direction","start","to","next","nextWeekFirstDay","movement","width","offsetWidth","xPersent","immediate","event","stopPropagation","first","axis","console","log","pointer","target","eventOptions","passive","handleTouchMove","e","moveX","touches","clientX","moveY","clientY","calendarWidth","calendarHeight","offsetHeight","Math","abs","disabledMonthView","handleTouchStart","handleTouchEnd","absTouchX","absTouchY","isMonthView","newTranslateIndex","nextMonthFirstDay","nexCurrentDay","handleShowTypeToggle","handleMonthToggle","type","isPrev","formatFun","operateDate","updateStateData","formatDay","color","format","head","calendarBodyHeight","map","height","style","dateList","index","isCurrentDay","isOtherMonthDay","isMarkDate","find","d"],"mappings":"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","sourcesContent":["/* eslint-disable react/destructuring-assignment */\n/**\n * 日视图/列表视图 日历\n */\nimport React, { FC, TouchEvent, useEffect, useRef } from 'react';\nimport dayjs, { Dayjs } from 'dayjs';\nimport throttle from 'lodash/throttle';\nimport cn from 'classnames';\nimport { animated, useSpring, useSprings } from '@react-spring/web';\nimport { useDrag, FullGestureState } from '@use-gesture/react';\n\nimport {\n    formatMonthData,\n    formatWeekData,\n    formatMonthYear,\n    mergeProps,\n} from '../../utils/index';\n\nimport { useSetState } from '../../utils/hooks';\n\nexport type CalendarProps = {\n    // 选中日期\n    currentDate?: Date;\n    // 展示方式\n    showType?: 'week' | 'month';\n    // 动画时间\n    transitionDuration?: number;\n    // 点击选中日期\n    onDateClick?: Function;\n    // 拖动开始\n    onTouchStart?: Function;\n    // 拖动过程\n    onTouchMove?: Function;\n    // 拖动结束\n    onTouchEnd?: (start: number, end: number) => void;\n    // 更换视图模式\n    onToggleShowType?: Function;\n    // 标记日期\n    markDates?: Date[];\n    // 禁用月视图\n    disabledMonthView?: boolean;\n};\n\nconst defaultFunc = (...rest: any) => {\n    // console.log('default function:', rest);\n};\n\nconst defaultCalendarProps = {\n    currentDate: new Date(),\n    showType: 'week',\n    transitionDuration: 0.3,\n    onDateClick: defaultFunc,\n    onTouchStart: defaultFunc,\n    onTouchMove: defaultFunc,\n    onTouchEnd: defaultFunc,\n    onToggleShowType: defaultFunc,\n    markDates: [],\n};\n\ntype DragType = Omit<FullGestureState<'drag'>, 'event'> & {\n    event: PointerEvent | MouseEvent | globalThis.TouchEvent | KeyboardEvent;\n};\n\ntype StateValue = {\n    currentMonthFirstDay: Dayjs;\n    monthDates: Dayjs[][];\n    currentWeekFirstDay: Dayjs;\n    weekDates: Dayjs[][];\n    currentDate: Dayjs;\n    touch: { x: number; y: number };\n    translateIndex: number;\n    calendarY: number;\n    showType: CalendarProps['showType'];\n};\n\nconst Calendar: FC<CalendarProps> = p => {\n    const props = mergeProps(defaultCalendarProps, p);\n\n    const [state, setState] = useSetState<StateValue>({\n        currentMonthFirstDay: dayjs().startOf('month'),\n        monthDates: [], // 月日历需要展示的日期 包括前一月 当月 下一月\n        currentWeekFirstDay: dayjs().startOf('week'),\n        weekDates: [], // 周日历需要展示的日期  包括前一周 当周 下一周\n        currentDate: dayjs(),\n        touch: { x: 0, y: 0 },\n        translateIndex: 0,\n        calendarY: 0, // 于Y轴的位置\n        showType: props.showType,\n    });\n\n    // 是否拖动中\n    const isTouchingRef = useRef(false);\n    // 拖动起始横坐标\n    const touchStartPositionXRef = useRef(0);\n    // 拖动起始纵坐标\n    const touchStartPositionYRef = useRef(0);\n    // 日历dom\n    const calendarRef = useRef<HTMLDivElement>(null);\n\n    const {\n        monthDates,\n        weekDates,\n        touch,\n        translateIndex,\n        calendarY,\n        currentMonthFirstDay,\n        currentWeekFirstDay,\n        showType,\n    } = state;\n\n    // 更新日期. 模拟 getDerivedStateFromProps\n    useEffect(() => {\n        const dayjsDate = dayjs(props.currentDate);\n        setState({\n            ...formatMonthData(dayjsDate),\n            ...formatWeekData(dayjsDate),\n            currentDate: dayjsDate,\n        });\n    }, [props.currentDate, setState]);\n\n    // 点击选中日期\n    const handleDayClick = (date: Dayjs) => {\n        if (dayjs(state.currentDate).isSame(date, 'day')) {\n            return;\n        }\n        setState({\n            ...formatMonthData(date),\n            ...formatWeekData(date),\n            currentDate: date,\n        });\n        props.onDateClick(date.toDate());\n    };\n\n    const [springStyles, springApi] = useSprings(3, i => ({\n        from: {\n            transform: `translate3d(${\n                (i -\n                    1 +\n                    state.translateIndex +\n                    (isTouchingRef.current ? state.touch.x : 0)) *\n                100\n            }%, ${calendarY}px, 0)`,\n            transitionDuration: `${props.transitionDuration}s`,\n        },\n        config: {\n            tension: 300,\n            friction: 30,\n            clamp: true,\n        },\n    }));\n\n    const runHorizontal = (dragState: DragType) => {\n        if (dragState.last) {\n            isTouchingRef.current = false;\n            const [distance] = dragState.distance;\n            if (distance > 50) {\n                const [direction] = dragState.direction;\n                springApi.start(i => ({\n                    to: async next => {\n                        // await next({\n                        //     transform: `translate3d(${\n                        //         (i - 1 + state.translateIndex - direction) * 100\n                        //     }%, ${calendarY}px, 0)`,\n                        //     transitionDuration: `${props.transitionDuration}s`,\n                        // });\n                        // await next({\n                        //     transitionDuration: `0s`,\n                        //     immediate: true,\n                        // });\n                        const nextWeekFirstDay = currentWeekFirstDay[\n                            direction> 0 ? 'subtract' : 'add'\n                        ](1, 'week');\n                        setState({\n                            translateIndex: state.translateIndex - direction,\n                        });\n                        handleDayClick(nextWeekFirstDay);\n                    },\n                }));\n            }\n            return;\n        }\n        const [x] = dragState.movement;\n        const width = calendarRef.current?.offsetWidth || 1;\n        const xPersent = x / width;\n        springApi.start(i => ({\n            transform: `translate3d(${\n                (i -\n                    1 +\n                    state.translateIndex +\n                    (isTouchingRef.current ? xPersent : 0)) *\n                100\n            }%, ${calendarY}px, 0)`,\n            transitionDuration: `0s`,\n            immediate: true,\n        }));\n    };\n\n    useDrag(\n        state => {\n            state.event.stopPropagation();\n            if (state.first) {\n                isTouchingRef.current = true;\n            }\n\n            if (state.axis === 'x') {\n                runHorizontal(state);\n            }\n            console.log(\n                '%c 2022-01-26, 131-info: state',\n                'color: fuchsia; background: Aquamarine; font-size: 20px;',\n                state\n            ); // Alian-log\n        },\n        {\n            pointer: { touch: true },\n            target: calendarRef,\n            eventOptions: { passive: false },\n        }\n    );\n\n    const handleTouchMove = throttle(e => {\n        e.stopPropagation();\n        const moveX = e.touches[0].clientX - touchStartPositionXRef.current;\n        const moveY = e.touches[0].clientY - touchStartPositionYRef.current;\n        const calendarWidth = calendarRef.current?.offsetWidth || 0;\n        const calendarHeight = calendarRef.current?.offsetHeight || 0;\n        if (Math.abs(moveX) > Math.abs(moveY)) {\n            // 左右滑动\n            setState({ touch: { x: moveX / calendarWidth, y: 0 } });\n        } else if (!props.disabledMonthView) {\n            setState({ touch: { x: 0, y: moveY / calendarHeight } });\n        }\n        props.onTouchMove(e);\n    }, 25);\n\n    const handleTouchStart = (e: TouchEvent<HTMLDivElement>) => {\n        e.stopPropagation();\n        touchStartPositionXRef.current = e.touches[0].clientX;\n        touchStartPositionYRef.current = e.touches[0].clientY;\n        isTouchingRef.current = true;\n        props.onTouchStart(e);\n    };\n\n    const handleTouchEnd = (e: TouchEvent<HTMLDivElement>) => {\n        e.stopPropagation();\n        const calendarHeight = calendarRef.current?.offsetHeight || 0;\n        isTouchingRef.current = false;\n        const absTouchX = Math.abs(touch.x);\n        const absTouchY = Math.abs(touch.y);\n        if (absTouchX > absTouchY && absTouchX > 0.15) {\n            const isMonthView = showType === 'month';\n            // touch.x > 0 右滑 日期减少, 回到上个月, translateIndex变大 向右偏移\n            const newTranslateIndex =\n                touch.x > 0 ? translateIndex + 1 : translateIndex - 1;\n\n            if (isMonthView) {\n                // 月视图\n                const nextMonthFirstDay = currentMonthFirstDay[\n                    touch.x > 0 ? 'subtract' : 'add'\n                ](1, 'month');\n                // const nextMonthStartDay = nextMonthFirstDay.startOf('week');\n                // const nextMonthEndDay = nextMonthStartDay.add(42, 'day');\n                setState({\n                    translateIndex: newTranslateIndex,\n                    ...formatMonthData(nextMonthFirstDay),\n                });\n                handleDayClick(nextMonthFirstDay);\n                // onTouchEnd(nextMonthStartDay.valueOf(), nextMonthEndDay.valueOf());\n            } else {\n                // 周视图\n                const nexCurrentDay = dayjs(state.currentDate)[\n                    touch.x > 0 ? 'subtract' : 'add'\n                ](1, 'week');\n                const nextWeekFirstDay = currentWeekFirstDay[\n                    touch.x > 0 ? 'subtract' : 'add'\n                ](1, 'week');\n                // const nextWeekLastDay = nextWeekFirstDay.add(7, 'day');\n                setState({\n                    translateIndex: newTranslateIndex,\n                    ...formatWeekData(nextWeekFirstDay),\n                });\n                handleDayClick(nexCurrentDay);\n                // onTouchEnd(nextWeekFirstDay.valueOf(), nextWeekLastDay.valueOf());\n            }\n        } else if (\n            absTouchY > absTouchX &&\n            Math.abs(touch.y * calendarHeight) > 50\n        ) {\n            if (props.disabledMonthView) {\n                // 禁用周视图\n            } else if (touch.y > 0 && showType === 'week') {\n                setState({ showType: 'month' });\n                // const cb = () => {\n                //     const dataArray = state.weekDates[1];\n                //     onToggleShowType({\n                //         showType: state.showType,\n                //         startTime: dataArray[0].valueOf(),\n                //         endTime: dataArray[dataArray.length - 1].add(1, 'day').valueOf()\n                //     });\n                // };\n                // cb();\n            } else if (touch.y < 0 && showType === 'month') {\n                setState({ showType: 'week' });\n                // const cb = () => {\n                //     const dataArray = state.weekDates[1];\n                //     onToggleShowType({\n                //         showType: state.showType,\n                //         startTime: dataArray[0].valueOf(),\n                //         endTime: dataArray[dataArray.length - 1].add(1, 'day').valueOf()\n                //     });\n                // };\n                // cb();\n            }\n        }\n        setState({ touch: { x: 0, y: 0 } });\n    };\n\n    const handleShowTypeToggle = () => {\n        setState({ showType: showType === 'month' ? 'week' : 'month' });\n    };\n\n    // 可以通过此函数 实现 点击按钮 进行月份切换\n    const handleMonthToggle = (type: 'prev' | 'next') => {\n        const { currentMonthFirstDay, currentWeekFirstDay, showType } = state;\n        const isMonthView = showType === 'month';\n        const isPrev = type === 'prev';\n        const formatFun = isMonthView ? formatMonthData : formatWeekData;\n        const operateDate = isMonthView\n            ? currentMonthFirstDay\n            : currentWeekFirstDay;\n        const updateStateData = formatFun(\n            operateDate[isPrev ? 'subtract' : 'add'](\n                1,\n                isMonthView ? 'month' : 'week'\n            )\n        );\n        setState(updateStateData);\n        // const cb = () => {\n        //     const dataArray = updateStateData[isMonthView ? 'monthDates' : 'weekDates'][1];\n        //     onTouchEnd(dataArray[0].valueOf(), dataArray[dataArray.length - 1].add(1, 'day').valueOf());\n        // };\n        // cb();\n    };\n\n    // 收起为周视图, 展开为月视图\n    const isMonthView = showType === 'month';\n\n    // 格式化日期显示\n    const formatDay = (date: Dayjs) => {\n        if (dayjs().isSame(date, 'day')) {\n            return <span style={{ color: '#3388FF' }}>今</span>;\n        }\n        // 'YYYY-MM-DD HH:mm:ss'\n        return dayjs(date).format('D');\n    };\n\n    const head = ['日', '一', '二', '三', '四', '五', '六'];\n\n    const calendarBodyHeight = (isMonthView ? 252 : 38) + 8;\n\n    return (\n        <div className='react-mob-calendar'>\n            {/* 年月 */}\n            <div className='calendar-operate'>\n                <div>{formatMonthYear(state.currentDate)}</div>\n            </div>\n\n            {/* 星期 */}\n            <div className='calendar-head'>\n                {head.map(i => (\n                    <div className='head-cell' key={i}>\n                        {i}\n                    </div>\n                ))}\n            </div>\n\n            {/* 日期表格 */}\n            <div\n                className={cn('calendar-body', { 'week-mode': isMonthView })}\n                style={{ height: calendarBodyHeight }}\n                ref={calendarRef}>\n                <div\n                    style={{\n                        transform: `translate3d(${\n                            -translateIndex * 100\n                        }%, 0, 0)`,\n                    }}\n                >\n                    {springStyles.map((style, i) => {\n                        const dateList = isMonthView ? monthDates : weekDates;\n                        return (\n                            <animated.div\n                                className='month-cell'\n                                key={i}\n                                style={style}>\n                                {dateList[i]?.map((date, index) => {\n                                    // 选中日期\n                                    const isCurrentDay = date.isSame(\n                                        state.currentDate,\n                                        'day'\n                                    );\n                                    // 其它月的日期, 在星期的模式下不显示置灰\n                                    const isOtherMonthDay =\n                                        showType === 'week'\n                                            ? false\n                                            : !date.isSame(\n                                                  currentMonthFirstDay,\n                                                  'month'\n                                              );\n                                    // 是否为标志过的日期\n                                    const isMarkDate = props.markDates.find(d =>\n                                        date.isSame(d, 'day')\n                                    );\n                                    return (\n                                        <div\n                                            key={index}\n                                            className={cn('day-cell', {\n                                                'is-other-month-day':\n                                                    isOtherMonthDay,\n                                                'current-day': isCurrentDay,\n                                            })}\n                                            onClick={() =>\n                                                handleDayClick(date)\n                                            }>\n                                            <div className='day-text'>\n                                                {formatDay(date)}\n                                            </div>\n                                            {isMarkDate && (\n                                                <div className='dot-mark' />\n                                            )}\n                                        </div>\n                                    );\n                                })}\n                            </animated.div>\n                        );\n                    })}\n                </div>\n                <div className='bottom-operate'>\n                    {!props.disabledMonthView && (\n                        <div\n                            role='presentation'\n                            onClick={handleShowTypeToggle}\n                            className='bottom-operate-btn'\n                        />\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default Calendar;\n"]},"metadata":{},"sourceType":"module"}